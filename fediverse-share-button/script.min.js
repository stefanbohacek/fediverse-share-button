const canUseLocalStorage="false"!==localStorage.getItem("fsb-consent-given");
const checkPlatformSupport=e=>{const t=e.parentElement.parentElement.getElementsByClassName("fsb-support-note")[0],n=e.parentElement.parentElement.getElementsByClassName("fsb-domain")[0];t.classList.add("fsb-d-none");let s=e.parentElement.parentElement.getElementsByClassName("fsb-note")[0];s||(s=document.createElement("p"),s.classList.add("fsb-note"),s.classList.add("fsb-d-none"),t.parentNode.insertBefore(s,t.nextSibling));const a=e.parentElement.parentElement.getElementsByClassName("fsb-support-note-link")[0];s&&s.classList.add("fsb-d-none"),supportedSoftware.includes(window.fsbGlobalSoftware)||(a.href=`https://${n.value}`,a.innerHTML=n.value,t.classList.remove("fsb-d-none")),s&&notes[window.fsbGlobalSoftware]&&(s.innerHTML=notes[window.fsbGlobalSoftware],s.classList.remove("fsb-d-none"))};
const doneTyping=async e=>{const n=e.parentElement.getElementsByClassName("fsb-button")[0],t=getDomain(e.value),a=await fetch(`https://fediverse-info.stefanbohacek.com/node-info?domain=${t}&onlysoftware=true`);n.innerHTML=n.innerHTML.replace("Loading","Share");const o=await a.json(),s=o?.software?.name,i=e.parentElement.getElementsByClassName("fsb-icon")[0];e.dataset.software=s,window.fsbGlobalSoftware=s,checkPlatformSupport(n),s&&knownSoftware.includes(s)?(updateTheIcon(i,s),supportedSoftware.includes(s)&&(n.disabled=!1)):updateTheIcon(i,"question")};
const getDomain=e=>e.replace(/(^\w+:|^)\/\//,"");
const getFSBPath=()=>{var s=document.getElementsByClassName("fsb-script")[0];return src=s.src,src.replace("/script.min.js","")};
const getPageDescription=()=>{let e="";const t=document.querySelector("meta[name='description']")||document.querySelector("meta[property='og:description']")||null;return t&&t.getAttribute&&(e=t.getAttribute("content")),encodeURIComponent(e)};
const getPageTitle=()=>{let t=document.title;try{t=document.querySelector("meta[property='og:title']").getAttribute("content")}catch(t){}return encodeURIComponent(t)};
const getPageURL=()=>encodeURIComponent(window.location.href);
const getSelectedText=()=>{let e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),truncate(e)};
const hidePlatformSupportVisibilityNote=e=>{e.parentElement.parentElement.getElementsByClassName("fsb-support-note")[0].classList.add("fsb-d-none")};
const knownSoftware=["activitypods","akkoma","anacus","andstatus","anfora","audon","awakari","azorius","bonfire","bookwyrm","bridgy_fed","brighteon_social","brutalinks","buttondown","calckey","castopod","chatter_net","chirp","communecter","diaspora","discourse","dolphin","drupal","emissary","epicyon","f2ap","fedibird","fedify","firefish","flipboard","flockingbird","flohmarkt","forgeflex","forgefriends","forgejo","foundkey","friendica","funkwhale","gancio","gath.io","ghost","gitlab","glitch-soc","gnu_social","goblin","goldfish","gotosocial","greatape","guppe","hollo","hometown","honk","hubzilla","iceshrimp","immers","juick","kazarma","kbin","kepi","ktistec","lemmy","libervia","loforo","loops","mangane","mastodon","mbin","micro.blog","minds","misskey","mistpark","mitra","mobilizon","neodb","nextcloud_social","nodebb","notestock","openengiadina","osada","owncast","peertube","piefed","pinetta","pixelfed","pleroma","plume","podcast_index","postmarks","prismo","quanta","rebased","redaktor","redmatrix","reel2bits","ruffy","seppo","sharky","shuttlecraft","skohub","smithereen","snac","soapbox","socialhome","streams","sublinks","swanye","takahe","takesama","threads","vernissage","viverse","vocata","wafrn","wildebeest","wordpress","write.as","writefreely","wxwclub","xwiki","yeet","zap"];
const notes={lemmy:'Older lemmy servers <a href="https://github.com/LemmyNet/lemmy-ui/issues/1913" target="_blank">may not work correctly</a>.'};
const supportedSoftware=["diaspora","firefish","friendica","glitch-soc","hometown","hubzilla","lemmy","mastodon","misskey","pleroma","sharkey","threads"];
const truncate=t=>t.length>5?`${t.substring(0,450)}...`:t;
let typingTimer;const doneTypingInterval=1300,updateIcon=async e=>{if(clearTimeout(typingTimer),e.value)typingTimer=setTimeout((()=>{doneTyping(e)}),1300);else{const n=e.parentElement.getElementsByClassName("fsb-icon")[0];updateTheIcon(n,"mastodon")}};
const updateTheIcon=(o,t)=>{o.src=`${getFSBPath()}/icons/${t}.svg`,o.alt=`${t} platform logo`};
(async()=>{const e=!!canUseLocalStorage&&localStorage.getItem("fsb-domain"),t=!!canUseLocalStorage&&localStorage.getItem("fsb-software");t&&(window.fsbGlobalSoftware=t),[...document.getElementsByClassName("fsb-prompt")].forEach((a=>{const s=a.getElementsByClassName("fsb-domain")[0],o=a.getElementsByClassName("fsb-button")[0];if(e)if(s.value=e,t){s.dataset.software=t,o.disabled=!0;const e=s.parentElement.getElementsByClassName("fsb-icon")[0];updateTheIcon(e,t),supportedSoftware.includes(t)&&(o.disabled=!1)}else updateIcon(s);s.addEventListener("input",(()=>{o.disabled=!0;const e=s.parentElement.getElementsByClassName("fsb-icon")[0];hidePlatformSupportVisibilityNote(o),updateTheIcon(e,"question"),s.value?o.innerHTML=o.innerHTML.replace("Share","Loading"):(updateTheIcon(e,"question"),o.innerHTML=o.innerHTML.replace("Loading","Share")),updateIcon(s)})),s.addEventListener("change",(()=>{})),a.addEventListener("submit",(e=>{e.preventDefault();const t=getDomain(s?.value?.trim());if(t?.length){const e=getSelectedText()||getPageTitle();canUseLocalStorage&&(localStorage.setItem("fsb-domain",t),window.fsbGlobalSoftware&&localStorage.setItem("fsb-software",window.fsbGlobalSoftware));let a=`https://${t}/share?text=${e+"%0A%0A"+getPageURL()}`;s?.dataset?.software&&(["diaspora","friendica"].includes(s.dataset.software)?a=`https://${t}/bookmarklet?url=${getPageURL()}&title=${e}&note=${getPageDescription()}`:"hubzilla"===s.dataset.software?a=`https://${t}/rpost?url=${getPageURL()}&body=${e}[br][br]`:"lemmy"===s.dataset.software?a=`https://${t}/create_post?title=${e}&url=${getPageURL()}&body=${getPageDescription()}`:"threads"===s.dataset.software&&(a=`https://${t}/intent/post?text=${e+"%0A%0A"+getPageURL()}`)),window.location.assign(a)}}))}))})();